<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>טופס מכר | משרד עו"ד גיא הרשקוביץ</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

    <!-- Encryption -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>

    <!-- PDF Generation -->
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.2/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <!-- Environment Configuration -->
    <script src="env-config.js"></script>

    <!-- CSS Files -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/sales-form.css">
    <link rel="stylesheet" href="css/billing.css">
<link rel="stylesheet" href="css/modals.css">
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen">
        <div class="login-card">
            <img src="assets/logo.png" alt="לוגו" style="max-width: 140px; height: auto; margin-bottom: 16px;">
            <h2>כניסה למערכת</h2>
            <p>משרד עו"ד גיא הרשקוביץ ושות'</p>
            <div class="form-group">
                <label>מייל</label>
                <input type="email" id="loginEmail" placeholder="email@example.com" dir="ltr" style="text-align: left;">
            </div>
            <div class="form-group">
                <label>סיסמה</label>
                <input type="password" id="loginPassword" placeholder="הזן סיסמה">
            </div>
            <button class="login-btn" id="loginBtn" onclick="handleLogin()">כניסה</button>
            <div class="login-error" id="loginError"></div>
        </div>
    </div>

    <div id="mainContainer" class="container" style="display: none;">
        <!-- Header -->
        <div class="header">
            <img src="assets/logo.png" alt="לוגו משרד עו"ד גיא הרשקוביץ" style="max-width: 200px; max-height: 80px; width: auto; height: auto; margin-bottom: 10px; object-fit: contain;">
            <h1>טופס מכר</h1>
            <p>משרד עו"ד גיא הרשקוביץ ושות'</p>
        </div>

        <!-- User Selection Screen -->
        <div id="userSelection" class="user-selection">
            <h2>שלום! מי מזין את הטופס?</h2>
            <p>בחר/י את שמך להמשך</p>
            <div class="user-grid">
                <button class="user-btn" onclick="selectUser('גיא הרשקוביץ')">
                    <div class="user-avatar">ג</div>
                    <div class="user-name">גיא</div>
                </button>
                <button class="user-btn" onclick="selectUser('מירי טל')">
                    <div class="user-avatar">מ</div>
                    <div class="user-name">מירי</div>
                </button>
                <button class="user-btn" onclick="selectUser('רועי הרשקוביץ')">
                    <div class="user-avatar">ר</div>
                    <div class="user-name">רועי</div>
                </button>
                <button class="user-btn" onclick="selectUser('אורי שטיינברג')">
                    <div class="user-avatar">א</div>
                    <div class="user-name">אורי</div>
                </button>
                <button class="user-btn" onclick="selectUser('חיים')">
                    <div class="user-avatar">ח</div>
                    <div class="user-name">חיים</div>
                </button>
            </div>
        </div>

        <!-- Main Form -->
        <div id="mainForm" class="hidden">
            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-steps">
                    <div class="progress-line" id="progressLine"></div>
                    <div class="step-indicator active" data-step="1">1</div>
                    <div class="step-indicator" data-step="2">2</div>
                    <div class="step-indicator" data-step="3">3</div>
                    <div class="step-indicator" data-step="4">4</div>
                </div>
                <div class="step-labels">
                    <span class="step-label active">פרטי לקוח</span>
                    <span class="step-label">העסקה</span>
                    <span class="step-label">תשלום</span>
                    <span class="step-label">סיכום</span>
                </div>
            </div>

            <form id="salesForm">
                <!-- Step 1: Client Details -->
                <div class="form-card form-step active" data-step="1">
                    <h3 class="step-title">
                        <span class="step-title-icon">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                        </span>
                        פרטי הלקוח
                    </h3>

                    <div class="form-group">
                        <label>שם הלקוח <span class="required">*</span></label>
                        <input type="text" id="clientName" placeholder="שם מלא / שם החברה" required autocomplete="off">
                        <div id="clientAutocomplete" class="autocomplete-dropdown"></div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>טלפון <span class="required">*</span></label>
                            <input type="text" id="phone" placeholder="050-0000000 או +972-50-0000000" required style="direction: ltr; text-align: right;">
                        </div>
                        <div class="form-group">
                            <label>ת.ז / ח.פ <span class="required">*</span></label>
                            <input type="text" id="idNumber" placeholder="מספר זהות או ח.פ" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>מייל <span class="required">*</span></label>
                        <input type="email" id="email" placeholder="email@example.com" required>
                    </div>

                    <div class="form-group">
                        <label>כתובת</label>
                        <input type="text" id="address" placeholder="רחוב, עיר (אופציונלי)">
                    </div>

                    <div class="form-group">
                        <label>סטטוס לקוח</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="newClient" name="clientStatus" value="חדש" checked>
                                <label for="newClient">לקוח חדש</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="existingClient" name="clientStatus" value="קיים">
                                <label for="existingClient">לקוח קיים</label>
                            </div>
                        </div>
                    </div>

                    <div class="buttons-row">
                        <button type="button" class="btn btn-primary" onclick="nextStep()">
                            המשך
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 12H5M12 19l-7-7 7-7"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Transaction Details -->
                <div class="form-card form-step" data-step="2">
                    <h3 class="step-title">
                        <span class="step-title-icon">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                            </svg>
                        </span>
                        פרטי העסקה
                    </h3>

                    <div class="form-group">
                        <label>סוג העסקה <span class="required">*</span></label>
                        <select id="transactionType" required>
                            <option value="">בחר סוג עסקה</option>
                            <option value="פגישת ייעוץ">פגישת ייעוץ</option>
                            <option value="ריטיינר">ריטיינר</option>
                            <option value="תוכנית שעות">תוכנית שעות</option>
                            <option value="הליך משפטי - תקרת שעות">הליך משפטי - תקרת שעות</option>
                            <option value="הליך משפטי - פיקס">הליך משפטי - פיקס</option>
                            <option value="אחר">אחר</option>
                        </select>
                    </div>

                    <!-- Conditional: Hours Package Fields -->
                    <div id="hoursPackageFields" class="conditional-field">
                        <div class="form-row">
                            <div class="form-group">
                                <label>כמות שעות <span class="required">*</span></label>
                                <input type="number" id="hoursQuantity" placeholder="מספר שעות" min="1" step="0.5">
                            </div>
                            <div class="form-group">
                                <label>מחיר לשעה (לפני מע"מ) <span class="required">*</span></label>
                                <input type="number" id="hourlyRate" placeholder="0" min="0">
                            </div>
                        </div>
                    </div>

                    <div class="form-group" id="transactionDescriptionGroup">
                        <label>תיאור העסקה <span class="required">*</span></label>
                        <textarea id="transactionDescription" placeholder="תאר את העסקה בקצרה..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label>סכום (לפני מע"מ) <span class="required">*</span></label>
                        <input type="number" id="amount" placeholder="0" min="0" step="any">
                    </div>

                    <!-- VAT Calculation Display -->
                    <div id="vatDisplay" class="vat-display">
                        <div class="vat-row">
                            <span class="vat-label">סכום לפני מע"מ:</span>
                            <span class="vat-value" id="amountBeforeVat">₪0</span>
                        </div>
                        <div class="vat-row">
                            <span class="vat-label">מע"מ (18%):</span>
                            <span class="vat-value" id="vatAmount">₪0</span>
                        </div>
                        <div class="vat-row">
                            <span class="vat-label">סכום כולל מע"מ:</span>
                            <span class="vat-value" id="amountWithVat">₪0</span>
                        </div>
                    </div>

                    <div class="buttons-row">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                            חזור
                        </button>
                        <button type="button" class="btn btn-primary" onclick="nextStep()">
                            המשך
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 12H5M12 19l-7-7 7-7"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Payment -->
                <div class="form-card form-step" data-step="3">
                    <h3 class="step-title">
                        <span class="step-title-icon">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                                <line x1="1" y1="10" x2="23" y2="10"></line>
                            </svg>
                        </span>
                        פרטי תשלום
                    </h3>

                    <div class="form-group">
                        <label>אמצעי תשלום <span class="required">*</span></label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="creditCard" name="paymentMethod" value="כרטיס אשראי" required>
                                <label for="creditCard">אשראי</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="bankTransfer" name="paymentMethod" value="העברה בנקאית">
                                <label for="bankTransfer">העברה</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="cash" name="paymentMethod" value="מזומן">
                                <label for="cash">מזומן</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="bit" name="paymentMethod" value="ביט">
                                <label for="bit">ביט</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="checks" name="paymentMethod" value="שיקים דחויים">
                                <label for="checks">שיקים</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="splitPayment" name="paymentMethod" value="פיצול תשלום">
                                <label for="splitPayment">פיצול תשלום</label>
                            </div>
                        </div>
                    </div>

                    <!-- Encouragement Message (appears after payment method selection) -->
                    <div id="encouragementMessage" class="encouragement-message hide"></div>

                    <!-- Split Payment Details (conditional) -->
                    <div id="splitPaymentDetails" class="conditional-field">
                        <!-- Amount Reminder -->
                        <div class="amount-reminder">
                            💰 סכום העסקה: <strong id="splitAmountReminder">₪0</strong> (כולל מע"מ)
                        </div>

                        <div style="background: var(--light-blue); border: 2px solid var(--primary-blue); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                            <div style="font-weight: 600; margin-bottom: 8px; color: var(--gray-800);">פרט את אמצעי התשלום:</div>
                            <div style="font-size: 13px; color: var(--gray-600);">הוסף כל אמצעי תשלום והסכום שלו</div>
                        </div>

                        <div id="splitPaymentRows">
                            <!-- Split payment rows will be added here dynamically -->
                        </div>

                        <button type="button" class="btn btn-secondary" onclick="addSplitPaymentRow()" style="margin-bottom: 16px;">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            הוסף אמצעי תשלום
                        </button>

                        <div id="splitPaymentSummary" class="vat-display" style="display: none;">
                            <div class="vat-row">
                                <span class="vat-label">סכום כולל שהוזן:</span>
                                <span class="vat-value" id="splitTotalEntered">₪0</span>
                            </div>
                            <div class="vat-row">
                                <span class="vat-label">סכום נותר:</span>
                                <span class="vat-value" id="splitRemaining" style="color: var(--error); font-weight: 700;">₪0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Credit Card Confirmation (conditional) -->
                    <div id="creditCardConfirmation" class="conditional-field">
                        <!-- Amount Reminder -->
                        <div class="amount-reminder">
                            💰 סכום העסקה: <strong id="ccAmountReminder">₪0</strong> (כולל מע"מ)
                        </div>

                        <div class="form-group">
                            <label>סטטוס החיוב באשראי <span class="required">*</span></label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="ccCharged" name="creditCardStatus" value="בוצע חיוב מלא">
                                    <label for="ccCharged">בוצע חיוב מלא</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="ccMonthly" name="creditCardStatus" value="חיוב חודשי">
                                    <label for="ccMonthly">חיוב חודשי</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="ccDeposit" name="creditCardStatus" value="פיקדון">
                                    <label for="ccDeposit">פיקדון</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="ccTemporary" name="creditCardStatus" value="אשראי זמני - יוחלף">
                                    <label for="ccTemporary">אשראי זמני - יוחלף</label>
                                </div>
                            </div>
                        </div>

                        <!-- Full Charge Details (conditional) -->
                        <div id="fullChargeDetails" class="conditional-field">
                            <div class="form-group">
                                <label>מספר תשלומים <span class="required">*</span></label>
                                <input type="number" id="paymentsCount" placeholder="כמה תשלומים?" min="1" max="36">
                            </div>
                        </div>

                        <!-- Monthly Charge Details (conditional) -->
                        <div id="monthlyChargeDetails" class="conditional-field">
                            <div style="background: #fef3c7; border: 2px solid #f59e0b; border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                                <div style="font-weight: 600; margin-bottom: 8px; color: #92400e;">
                                    הגדרת חיוב חודשי קבוע
                                </div>
                                <div style="font-size: 13px; color: #78350f;">
                                    המערכת תשלח תזכורות אוטומטיות יום לפני כל חיוב
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>סכום חיוב חודשי (כולל מע"מ) <span class="required">*</span></label>
                                    <input type="number" id="recurringMonthlyAmount" placeholder="0" min="0" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label>מספר חודשים <span class="required">*</span></label>
                                    <input type="number" id="recurringMonthsCount" placeholder="כמה חודשים?" min="1" max="60">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>תאריך חיוב ראשון <span class="required">*</span></label>
                                    <input type="date" id="recurringStartDate">
                                </div>
                                <div class="form-group">
                                    <label>יום בחודש לחיוב</label>
                                    <input type="number" id="recurringDayOfMonth" placeholder="לדוגמה: 1, 15" min="1" max="28" value="1">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>הערות לגבייה</label>
                                <textarea id="recurringNotes" placeholder="הערות נוספות לגבי החיוב החודשי..."></textarea>
                            </div>
                        </div>

                        <!-- Deposit Details (conditional) -->
                        <div id="depositDetails" class="conditional-field">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>סכום חודשי לחיוב <span class="required">*</span></label>
                                    <input type="number" id="monthlyCharge" placeholder="0" min="0" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label>מספר חודשים</label>
                                    <input type="number" id="monthsCount" placeholder="כמה חודשים?" min="1">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>פרטים נוספים על הפיקדון</label>
                                <textarea id="depositDetailsText" placeholder="תאריך תחילת חיוב, הערות..."></textarea>
                            </div>
                        </div>

                        <!-- Temporary Credit Card - Replacement Details (conditional) -->
                        <div id="temporaryCreditDetails" class="conditional-field">
                            <div class="form-group">
                                <label>פרטי החלפה <span class="required">*</span></label>
                                <textarea id="temporaryCreditText" placeholder="לדוגמה: יוחלף לצ'קים ב-01/03/2025, יוחלף להעברה בנקאית..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Checks Details (conditional) -->
                    <div id="checksDetails" class="conditional-field">
                        <!-- Amount Reminder -->
                        <div class="amount-reminder">
                            💰 סכום העסקה: <strong id="checksAmountReminder">₪0</strong> (כולל מע"מ)
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>מספר שיקים <span class="required">*</span></label>
                                <input type="number" id="checksCount" placeholder="כמה שיקים?" min="1">
                            </div>
                            <div class="form-group">
                                <label>סכום כולל <span class="required">*</span></label>
                                <input type="number" id="checksTotalAmount" placeholder="0" min="0" step="0.01">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>צילום שיקים <span class="required">*</span></label>
                            <div class="file-upload-container" id="checksUploadContainer" onclick="document.getElementById('checksPhoto').click()">
                                <input type="file" id="checksPhoto" accept="image/*,application/pdf" style="display: none;">
                                <div class="upload-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                                        <circle cx="12" cy="13" r="4"></circle>
                                    </svg>
                                </div>
                                <div class="upload-text">לחץ לצילום או בחירת תמונה</div>
                                <div class="upload-subtext">תמונה ברורה של השיקים</div>
                            </div>
                            <div class="file-preview" id="checksPreview">
                                <div class="file-name" id="checksFileName"></div>
                                <img id="checksImage" alt="צילום שיקים">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>פירוט שיקים</label>
                            <div id="checksDetailsContainer"></div>
                        </div>

                        <div class="form-group">
                            <label>הערות נוספות על השיקים (אופציונלי)</label>
                            <textarea id="checksDetailsText" placeholder="הערות נוספות..."></textarea>
                        </div>

                        <div class="form-group">
                            <label>האם השיק יוחלף באמצעי תשלום אחר?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="checkWillChange" name="checkWillChange" value="כן">
                                    <label for="checkWillChange">כן</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="checkWillNotChange" name="checkWillChange" value="לא" checked>
                                    <label for="checkWillNotChange">לא</label>
                                </div>
                            </div>
                        </div>

                        <!-- Check Replacement Details (conditional) -->
                        <div id="checkReplacementDetails" class="form-group conditional-field">
                            <label>פרט את אמצעי התשלום החלופי <span class="required">*</span></label>
                            <textarea id="checkReplacementText" placeholder="לדוגמה: יוחלף בכרטיס אשראי ב-15/02/2025, העברה בנקאית וכו..."></textarea>
                        </div>
                    </div>

                    <div class="buttons-row">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                            חזור
                        </button>
                        <button type="button" class="btn btn-primary" onclick="nextStep()">
                            המשך
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 12H5M12 19l-7-7 7-7"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Step 4: Summary & Submit -->
                <div class="form-card form-step" data-step="4">
                    <h3 class="step-title">
                        <span class="step-title-icon">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                            </svg>
                        </span>
                        פרטים נוספים וסיכום
                    </h3>

                    <div class="form-group">
                        <label>עו"ד מטפל <span class="required">*</span></label>
                        <select id="attorney" required>
                            <option value="">בחר עו"ד</option>
                            <option value="גיא הרשקוביץ">גיא הרשקוביץ</option>
                            <option value="מירי טל">מירי טל</option>
                            <option value="רועי הרשקוביץ">רועי הרשקוביץ</option>
                            <option value="אורי שטיינברג">אורי שטיינברג</option>
                            <option value="חיים">חיים</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>מספר תיק בעודכנית</label>
                            <input type="text" id="caseNumber" placeholder="אם ידוע">
                        </div>
                        <div class="form-group">
                            <label>סניף</label>
                            <select id="branch">
                                <option value="תל אביב" selected>תל אביב</option>
                                <option value="רחובות">רחובות</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>הערות</label>
                        <textarea id="notes" placeholder="הערות נוספות (אופציונלי)"></textarea>
                    </div>

                    <div class="buttons-row">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                            חזור
                        </button>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <span id="submitText">שלח טופס</span>
                            <div class="spinner hidden" id="submitSpinner"></div>
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Success Screen -->
        <div id="successScreen" class="form-card success-screen">
            <!-- Confetti Elements -->
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>

            <div class="celebration-emoji">🎉</div>

            <div class="success-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            </div>

            <h2>כל הכבוד! מכירה חדשה!</h2>
            <p class="subtitle">הרשומה נשמרה בהצלחה במערכת</p>

            <div class="sale-summary">
                <div class="sale-summary-title">📊 סיכום המכירה</div>

                <div class="sale-detail">
                    <span class="sale-detail-label">לקוח:</span>
                    <span class="sale-detail-value" id="summaryClientName">-</span>
                </div>

                <div class="sale-detail">
                    <span class="sale-detail-label">סוג עסקה:</span>
                    <span class="sale-detail-value" id="summaryTransactionType">-</span>
                </div>

                <div class="sale-detail">
                    <span class="sale-detail-label">אמצעי תשלום:</span>
                    <span class="sale-detail-value" id="summaryPaymentMethod">-</span>
                </div>

                <div class="sale-amount">
                    ₪<span id="summaryAmount">0</span>
                    <div style="font-size: 14px; font-weight: 400; margin-top: 4px;">כולל מע"מ</div>
                </div>
            </div>

            <button class="btn btn-primary" onclick="resetForm()" style="max-width: 250px; margin: 0 auto; font-size: 16px;">
                🚀 מכירה נוספת
            </button>
        </div>
    </div>

    <!-- Billing Management View -->
    <div id="billingManagement">
        <div class="bm-header">
            <h2>ניהול גבייה חודשית</h2>
            <div style="display:flex;gap:8px;align-items:center;">
                <!-- Notification Bell -->
                <div class="bm-notif-wrapper" id="bmNotifWrapper">
                    <button class="bm-notif-btn" id="bmNotifBtn" onclick="toggleNotifications(event)" title="התראות גבייה">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                        <span class="bm-notif-badge" id="bmNotifBadge" style="display:none;">0</span>
                    </button>
                    <div class="bm-notif-panel" id="bmNotifPanel">
                        <div class="bm-notif-header">
                            <span>התראות גבייה</span>
                            <span class="bm-notif-count" id="bmNotifCount">0 פריטים</span>
                        </div>
                        <div class="bm-notif-list" id="bmNotifList"></div>
                    </div>
                </div>
                <button class="bm-sync-btn" id="bmExportBtn" onclick="exportBillingReport()" title="ייצוא דוח גבייה לקובץ CSV">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    ייצוא דוח
                </button>
                <button class="bm-back-btn" onclick="hideBillingManagement()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                    חזרה
                </button>
            </div>
        </div>

        <!-- Summary Stats -->
        <div class="bm-summary">
            <div class="bm-stat blue">
                <div class="bm-stat-value" id="bmStatTotal">0</div>
                <div class="bm-stat-label">לקוחות פעילים</div>
            </div>
            <div class="bm-stat">
                <div class="bm-stat-value" id="bmStatMonthly">₪0</div>
                <div class="bm-stat-label">גבייה חודשית</div>
            </div>
            <div class="bm-stat green">
                <div class="bm-stat-value" id="bmStatPaid">₪0</div>
                <div class="bm-stat-label">שולם עד כה</div>
            </div>
            <div class="bm-stat red">
                <div class="bm-stat-value" id="bmStatRemaining">₪0</div>
                <div class="bm-stat-label">יתרה לגבייה</div>
            </div>
        </div>

        <!-- Toolbar -->
        <div class="bm-toolbar">
            <input type="text" class="bm-search" id="bmSearch" placeholder="חיפוש לקוח..." oninput="filterBillingView()">
            <div class="bm-filters">
                <button class="bm-filter-btn active" data-filter="all" onclick="setBillingFilter('all', this)">הכל</button>
                <button class="bm-filter-btn" data-filter="פעיל" onclick="setBillingFilter('פעיל', this)">פעילים</button>
                <button class="bm-filter-btn" data-filter="מושהה" onclick="setBillingFilter('מושהה', this)">מושהים</button>
                <button class="bm-filter-btn" data-filter="בוטל" onclick="setBillingFilter('בוטל', this)">בוטלו</button>
            </div>
            <div class="bm-view-toggle">
                <button class="bm-view-btn active" id="bmViewTable" onclick="setBillingViewMode('table')" title="תצוגת טבלה">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v18H3z"/><path d="M3 9h18"/><path d="M3 15h18"/><path d="M9 3v18"/></svg>
                </button>
                <button class="bm-view-btn" id="bmViewCards" onclick="setBillingViewMode('cards')" title="תצוגת כרטיסיות">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
                </button>
            </div>
        </div>

        <!-- Table View -->
        <div id="bmTableView">
            <div class="bm-table-wrap">
                <table class="bm-table">
                    <thead>
                        <tr>
                            <th>לקוח</th>
                            <th>עו"ד מטפל</th>
                            <th>חיוב הבא <span style="font-weight:400;font-size:10px;color:#94a3b8;">(כולל מע"מ)</span></th>
                            <th>סה"כ עסקה</th>
                            <th>שולם</th>
                            <th>התקדמות</th>
                            <th>סטטוס</th>
                            <th>חיוב הבא</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="bmTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Cards View -->
        <div id="bmCardsView" style="display: none;">
            <div class="bm-cards" id="bmCardsContainer">
            </div>
        </div>

        <!-- Loading -->
        <div id="bmLoading" class="bm-loading" style="display: none;">
            <div class="bm-loading-spinner"></div>
            טוען נתוני גבייה...
        </div>

        <!-- Empty State -->
        <div id="bmEmpty" class="bm-empty" style="display: none;">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 3h18v18H3z"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>
            <p>אין לקוחות בגבייה חודשית</p>
        </div>

        <!-- Footer -->
        <div class="bm-footer">
            <p>נבנה על ידי חיים פרץ | כל הזכויות שמורות למשרד עו"ד גיא הרשקוביץ &copy; 2026</p>
        </div>
    </div>

    <!-- Billing Modal -->
    <div id="billingModalOverlay" class="billing-modal-overlay" onclick="if(event.target===this) closeBillingModal()">
        <div class="billing-modal">
            <div class="billing-modal-header">
                <h3>הוספת לקוח לגבייה חודשית</h3>
                <button class="billing-modal-close" onclick="closeBillingModal()">&times;</button>
            </div>
            <div class="billing-modal-body" id="billingModalBody">
                <div class="billing-section-title">פרטי לקוח</div>

                <div class="form-group billing-search-container">
                    <label>חיפוש לקוח קיים</label>
                    <input type="text" id="billingClientSearch" placeholder="הקלד שם לקוח לחיפוש..." autocomplete="off">
                    <div id="billingAutocomplete" class="billing-autocomplete"></div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>שם הלקוח <span class="required">*</span></label>
                        <input type="text" id="billingClientName" placeholder="שם מלא / שם חברה" required>
                    </div>
                    <div class="form-group">
                        <label>טלפון</label>
                        <input type="tel" id="billingPhone" placeholder="050-0000000">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>מייל</label>
                        <input type="email" id="billingEmail" placeholder="email@example.com">
                    </div>
                    <div class="form-group">
                        <label>ח.פ / ת.ז</label>
                        <input type="text" id="billingIdNumber" placeholder="מספר זיהוי">
                    </div>
                </div>

                <div class="form-group">
                    <label>כתובת</label>
                    <input type="text" id="billingAddress" placeholder="כתובת הלקוח">
                </div>

                <div class="billing-section-title">פרטי גבייה חודשית</div>

                <div class="form-row">
                    <div class="form-group">
                        <label>סה"כ סכום לגבייה (כולל מע"מ) <span class="required">*</span></label>
                        <input type="number" id="billingTotalDeal" placeholder="סך כולל" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>מספר תשלומים <span class="required">*</span></label>
                        <input type="number" id="billingMonths" placeholder="כמה תשלומים?" min="1" max="60" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>סכום לכל תשלום (מחושב אוטומטית)</label>
                    <input type="number" id="billingAmount" placeholder="יחושב אוטומטית" min="0" step="0.01" readonly
                        style="background:#f8fafc;color:#64748b;">
                    <div style="font-size:11px;color:var(--gray-400);margin-top:3px;">ניתן לערוך כל תשלום בנפרד בטבלה למטה</div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>תאריך חיוב ראשון <span class="required">*</span></label>
                        <input type="date" id="billingStartDate" required>
                    </div>
                    <div class="form-group">
                        <label>יום בחודש לחיוב</label>
                        <input type="number" id="billingDayOfMonth" placeholder="1" min="1" max="28" value="1">
                    </div>
                </div>

                <div class="form-group">
                    <label>חודשים ששולמו כבר</label>
                    <input type="number" id="billingPaidMonths" placeholder="0 (אם הלקוח חדש)" min="0" max="60" value="0">
                    <div style="font-size: 11px; color: var(--gray-400); margin-top: 4px;">למקרה שהלקוח כבר שילם חלק מהתשלומים לפני ההכנסה למערכת</div>
                </div>

                <!-- טבלת סכומים לכל חודש -->
                <div id="billingAmountsPreview" style="display:none;margin-top:12px;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                        <label style="font-weight:600;font-size:13px;color:var(--gray-700);">פירוט סכומים לכל חודש</label>
                        <button type="button" onclick="toggleAmountsTable()" id="billingAmountsToggle" style="background:none;border:1px solid var(--primary-blue);color:var(--primary-blue);border-radius:6px;padding:4px 12px;font-size:11px;font-family:Heebo,sans-serif;cursor:pointer;">ערוך סכומים</button>
                    </div>
                    <div id="billingAmountsTable" style="display:none;max-height:250px;overflow-y:auto;border:1px solid var(--gray-200);border-radius:8px;padding:8px;background:var(--gray-50);"></div>
                    <div id="billingAmountsSummary" style="font-size:12px;color:var(--gray-500);margin-top:4px;"></div>
                </div>

                <div class="billing-section-title">פרטי כרטיס אשראי</div>
                <div style="font-size: 11px; color: var(--gray-400); margin-bottom: 12px; display: flex; align-items: center; gap: 6px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                    המידע מוצפן ונשמר בצורה מאובטחת. לצפייה במספר המלא נדרשת סיסמת המשרד.
                </div>

                <div class="form-group">
                    <label>מספר כרטיס אשראי</label>
                    <input type="text" id="billingCardNumber" placeholder="0000 0000 0000 0000" maxlength="19" dir="ltr" style="text-align: left; letter-spacing: 2px; font-variant-numeric: tabular-nums;" autocomplete="off">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>תוקף</label>
                        <input type="text" id="billingCardExpiry" placeholder="MM/YY" maxlength="5" dir="ltr" style="text-align: left;" autocomplete="off">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>שם בעל הכרטיס</label>
                        <input type="text" id="billingCardHolder" placeholder="שם כפי שמופיע על הכרטיס">
                    </div>
                    <div class="form-group">
                        <label>סוג כרטיס</label>
                        <select id="billingCardType">
                        <option value="">בחר סוג</option>
                        <option value="ויזה">ויזה (Visa)</option>
                        <option value="מאסטרקארד">מאסטרקארד (Mastercard)</option>
                        <option value="אמריקן אקספרס">אמריקן אקספרס (Amex)</option>
                        <option value="ישראכרט">ישראכרט</option>
                        <option value="דיינרס">דיינרס</option>
                        <option value="אחר">אחר</option>
                    </select>
                    </div>
                </div>

                <div class="billing-section-title">פרטים נוספים</div>

                <div class="form-row">
                    <div class="form-group">
                        <label>עו"ד מטפל <span class="required">*</span></label>
                        <select id="billingAttorney" required>
                            <option value="">בחר עו"ד</option>
                            <option value="גיא הרשקוביץ">גיא הרשקוביץ</option>
                            <option value="מירי טל">מירי טל</option>
                            <option value="רועי הרשקוביץ">רועי הרשקוביץ</option>
                            <option value="אורי שטיינברג">אורי שטיינברג</option>
                            <option value="חיים">חיים</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>מספר תיק</label>
                        <input type="text" id="billingCaseNumber" placeholder="מספר תיק בעודכנית">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>סניף</label>
                        <select id="billingBranch">
                            <option value="תל אביב">תל אביב</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>סוג העסקה</label>
                        <select id="billingTransactionType">
                            <option value="ריטיינר">ריטיינר</option>
                            <option value="תוכנית שעות">תוכנית שעות</option>
                            <option value="הליך משפטי - פיקס">הליך משפטי - פיקס</option>
                            <option value="אחר">אחר</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>הערות</label>
                    <textarea id="billingNotes" placeholder="הערות נוספות..." rows="2"></textarea>
                </div>
            </div>

            <div class="billing-modal-footer" id="billingModalFooter">
                <button class="billing-btn-cancel" onclick="closeBillingModal()">ביטול</button>
                <button class="billing-btn-submit" id="billingSubmitBtn" onclick="submitBillingForm()">
                    <span id="billingSubmitText">שמור וצור תזכורות</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Billing Client Modal -->
    <div id="editModalOverlay" class="edit-modal-overlay" onclick="if(event.target===this) closeEditModal()">
        <div class="edit-modal">
            <div class="edit-modal-header">
                <h3>עריכת לקוח גבייה</h3>
                <button class="edit-modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="edit-modal-body" id="editModalBody">
                <input type="hidden" id="editDocId">

                <div class="billing-section-title" style="background:#dbeafe;color:#1d4ed8;">פרטי לקוח</div>

                <div class="form-row">
                    <div class="form-group">
                        <label>שם הלקוח <span class="required">*</span></label>
                        <input type="text" id="editClientName" required>
                    </div>
                    <div class="form-group">
                        <label>טלפון</label>
                        <input type="tel" id="editPhone">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>מייל</label>
                        <input type="email" id="editEmail">
                    </div>
                    <div class="form-group">
                        <label>ח.פ / ת.ז</label>
                        <input type="text" id="editIdNumber">
                    </div>
                </div>
                <div class="form-group">
                    <label>כתובת</label>
                    <input type="text" id="editAddress">
                </div>

                <div class="billing-section-title" style="background:#dbeafe;color:#1d4ed8;">פרטי גבייה</div>

                <div class="form-row">
                    <div class="form-group">
                        <label>סה"כ סכום לגבייה (כולל מע"מ) <span class="required">*</span></label>
                        <input type="number" id="editTotalDeal" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>מספר תשלומים <span class="required">*</span></label>
                        <input type="number" id="editMonths" min="1" max="60" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>סכום לכל תשלום (מחושב אוטומטית)</label>
                    <input type="number" id="editAmount" readonly style="background:#f8fafc;color:#64748b;">
                </div>
                <div id="editAmountsPreview" style="display:none;margin:8px 0;">
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;">
                        <span style="font-size:12px;font-weight:600;color:#0f172a;">פירוט תשלומים</span>
                        <button type="button" id="editAmountsToggle" onclick="toggleEditAmountsTable()" style="font-size:11px;padding:3px 10px;border:1px solid #e2e8f0;border-radius:4px;cursor:pointer;background:none;color:var(--primary-blue);font-family:Heebo,sans-serif;">ערוך סכומים</button>
                    </div>
                    <div id="editAmountsTable" style="display:none;max-height:200px;overflow-y:auto;border:1px solid #e2e8f0;border-radius:6px;"></div>
                    <div id="editAmountsSummary" style="font-size:12px;color:#64748b;margin-top:4px;text-align:center;"></div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>תאריך חיוב ראשון</label>
                        <input type="date" id="editStartDate">
                    </div>
                    <div class="form-group">
                        <label>יום בחודש לחיוב</label>
                        <input type="number" id="editDayOfMonth" min="1" max="28">
                    </div>
                </div>
                <div class="form-group">
                    <label>חודשים ששולמו כבר</label>
                    <input type="number" id="editPaidMonths" min="0" max="60">
                </div>
                <div class="form-group">
                    <label>סטטוס</label>
                    <select id="editStatus">
                        <option value="פעיל">פעיל</option>
                        <option value="מושהה">מושהה</option>
                        <option value="בוטל">בוטל</option>
                    </select>
                </div>

                <div class="billing-section-title" style="background:#dbeafe;color:#1d4ed8;">פרטי כרטיס אשראי</div>
                <div style="font-size: 11px; color: var(--gray-400); margin-bottom: 12px; display: flex; align-items: center; gap: 6px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                    <span id="editCardStatus">לא הוזן כרטיס</span>
                </div>
                <div class="form-group">
                    <label>מספר כרטיס חדש (השאר ריק לשמור הקיים)</label>
                    <input type="text" id="editCardNumber" placeholder="0000 0000 0000 0000" maxlength="19" dir="ltr" style="text-align:left;letter-spacing:2px;font-variant-numeric:tabular-nums;" autocomplete="off">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>תוקף</label>
                        <input type="text" id="editCardExpiry" placeholder="MM/YY" maxlength="5" dir="ltr" style="text-align:left;" autocomplete="off">
                    </div>
                </div>
                <div class="form-group">
                    <label>שם בעל הכרטיס</label>
                    <input type="text" id="editCardHolder">
                </div>
                <div class="form-group">
                    <label>סוג כרטיס</label>
                    <select id="editCardType">
                        <option value="">בחר סוג</option>
                        <option value="ויזה">ויזה (Visa)</option>
                        <option value="מאסטרקארד">מאסטרקארד (Mastercard)</option>
                        <option value="אמריקן אקספרס">אמריקן אקספרס (Amex)</option>
                        <option value="ישראכרט">ישראכרט</option>
                        <option value="דיינרס">דיינרס</option>
                        <option value="אחר">אחר</option>
                    </select>
                </div>

                <div class="billing-section-title" style="background:#dbeafe;color:#1d4ed8;">פרטים נוספים</div>

                <div class="form-row">
                    <div class="form-group">
                        <label>עו"ד מטפל</label>
                        <select id="editAttorney">
                            <option value="">בחר עו"ד</option>
                            <option value="גיא הרשקוביץ">גיא הרשקוביץ</option>
                            <option value="מירי טל">מירי טל</option>
                            <option value="רועי הרשקוביץ">רועי הרשקוביץ</option>
                            <option value="אורי שטיינברג">אורי שטיינברג</option>
                            <option value="חיים">חיים</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>מספר תיק</label>
                        <input type="text" id="editCaseNumber">
                    </div>
                </div>
                <div class="form-group">
                    <label>הערות</label>
                    <textarea id="editNotes" rows="2"></textarea>
                </div>
            </div>
            <div class="edit-modal-footer">
                <button class="edit-btn-cancel" onclick="closeEditModal()">ביטול</button>
                <button class="edit-btn-save" id="editSaveBtn" onclick="saveEditBilling()">שמור שינויים</button>
            </div>
        </div>
    </div>

    <!-- Payment Details Modal -->
    <div id="pmOverlay" class="pm-overlay" onclick="if(event.target===this) closePaymentModal()">
        <div class="pm-modal">
            <div class="pm-header">
                <h3 id="pmTitle">פירוט תשלומים</h3>
                <button class="pm-close" onclick="closePaymentModal()">&times;</button>
            </div>
            <div class="pm-body" id="pmBody">
                <div class="pm-client-summary" id="pmClientSummary"></div>
                <div class="pm-list-header">
                    <div>#</div>
                    <div>תאריך חיוב</div>
                    <div style="text-align:center;">סכום מתוכנן</div>
                    <div style="text-align:center;">שולם בפועל</div>
                    <div></div>
                </div>
                <div id="pmPaymentsList"></div>
                <div class="pm-accounting" id="pmAccounting"></div>
            </div>
            <div class="pm-footer">
                <div style="display:flex;gap:8px;">
                    <button class="pm-footer-btn" onclick="closePaymentModal()">סגור</button>
                    <button class="pm-footer-btn danger" onclick="cancelBillingSeriesUI()">ביטול סדרה</button>
                    <button class="pm-footer-btn" onclick="extendBillingSeriesUI()">הוסף חודשים</button>
                </div>
                <button class="pm-footer-btn primary" id="pmMarkAllBtn" onclick="markNextPayment()">
                    סמן תשלום הבא כבוצע
                </button>
            </div>
        </div>
    </div>

    <!-- Password Popup -->
    <div id="pwPopupOverlay" class="pw-popup-overlay">
        <div class="pw-popup">
            <div class="pw-popup-icon">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"/><path d="M1 10h22"/></svg>
            </div>
            <h3 id="pwPopupTitle">סיסמת הצפנה</h3>
            <div class="pw-desc" id="pwPopupDesc">
                סיסמה זו משמשת להצפנת פרטי כרטיס האשראי של הלקוח.<br>
                רק מי שיודע את הסיסמה יוכל לצפות במספר הכרטיס המלא.
            </div>
            <div class="pw-warning">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="flex-shrink:0;margin-top:1px;"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                <span>שמור את הסיסמה במקום בטוח. <strong>אם הסיסמה תישכח - לא ניתן לשחזר את פרטי הכרטיסים.</strong> אל תשתף אותה בהודעות או במייל.</span>
            </div>
            <input type="password" id="pwPopupInput" placeholder="הזן סיסמה">
            <div class="pw-popup-buttons">
                <button class="pw-popup-cancel" id="pwPopupCancel">ביטול</button>
                <button class="pw-popup-confirm" id="pwPopupConfirm">אישור</button>
            </div>
            <div class="pw-popup-error" id="pwPopupError"></div>
        </div>
    </div>

    <!-- Input Modal (replacement for prompt()) -->
    <div id="inputModalOverlay" class="pw-popup-overlay">
        <div class="pw-popup">
            <h3 id="inputModalTitle">הזנת ערך</h3>
            <div class="pw-desc" id="inputModalDesc"></div>
            <input id="inputModalInput" autocomplete="off">
            <div class="pw-popup-buttons">
                <button class="pw-popup-cancel" id="inputModalCancel">ביטול</button>
                <button class="pw-popup-confirm" id="inputModalConfirm">אישור</button>
            </div>
            <div class="pw-popup-error" id="inputModalError"></div>
        </div>
    </div>


    <!-- JavaScript Files -->
    <script src="js/firebase-init.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/client-search.js"></script>
    <script src="js/sales-form.js"></script>
    <script src="js/file-upload.js"></script>
    <script src="js/sheets-sync.js"></script>
    <script src="js/encryption.js"></script>
    <script src="js/billing.js"></script>
    <script src="js/payments.js"></script>
<script src="js/navigation.js"></script>

    <!-- Bottom Navigation Bar -->
    <nav class="bottom-nav bottom-nav-hidden" id="bottomNav">
        <button class="bottom-nav-item active" id="navHomeBtn" onclick="navHome()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            <span class="bottom-nav-label">ראשי</span>
        </button>
        <button class="bottom-nav-item" id="navAddBillingBtn" onclick="navAddBilling()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v8M8 12h8"/></svg>
            <span class="bottom-nav-label">הוספת גבייה</span>
        </button>
        <button class="bottom-nav-item" id="navBillingMgmtBtn" onclick="navBillingMgmt()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v18H3z"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>
            <span class="bottom-nav-label">ניהול גבייה</span>
        </button>
        <button class="bottom-nav-item" onclick="navLogout()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
            <span class="bottom-nav-label">התנתק</span>
        </button>
    </nav>
</body>
</html>
